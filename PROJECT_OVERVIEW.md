# Technical Specification Report: Pool & Cafe Web Application

## 1. Technology Stack Overview

### Frontend (Customer Facing)
- **Framework:** React.js (Vite)
- **Styling:** Vanilla CSS (Custom Design System)
- **3D/Immersive:** `@react-three/fiber`, `@react-three/drei`, `three.js` (for Hero Scene & parallax effects)
- **State Management:** React Context API (`AuthContext`)
- **Routing:** `react-router-dom`

### Frontend (Admin Dashboard)
- **Framework:** Next.js 14+ (App Router)
- **Styling:** Tailwind CSS (`lucide-react` for icons)
- **State Management:** React Context API (`AuthContext`, `PoolContext`, `SearchContext`)
- **Components:** Custom responsive components (`AppShell`, `Sidebar`, `BookingWidget`)

### Backend
- **Runtime:** Node.js
- **Framework:** Express.js
- **Security:** `helmet` (implied), `cors`, `bcryptjs`, `jsonwebtoken`

### Database
- **Primary:** MongoDB (Atlas)
- **ODM:** Mongoose (Schemas for User, Booking, Table, MenuItem, Order, Inventory)

---

## 2. API Inventory & Role-Based Access (RBAC)

### Authentication Flow
1.  **Login:** User sends credentials → Server verifies hash → Returns JWT (expiry: 1h).
2.  **Request:** Client sends JWT in `x-auth-token` header.
3.  **Middleware:**
    -   `auth`: Verifies JWT signature and decodes payload (`user.id`, `user.role`).
    -   `roleCheck(allowedRoles)`: Checks if `req.user.role` is in `allowedRoles`.

### API Inventory

| Endpoint | Method | Purpose | Access Level |
| :--- | :--- | :--- | :--- |
| **Auth** | | | |
| `/api/auth/register` | POST | Register new customer | Public |
| `/api/auth/login` | POST | Login (Customer/Admin) | Public |
| **Admin Dashboard** | | | |
| `/api/admin/dashboard-stats` | GET | Key KPIs (Revenue, Bookings) | `admin`, `manager` |
| `/api/admin/tables` | GET/POST | Manage Pool Tables | `admin`, `manager`, `staff` |
| `/api/admin/bookings` | GET | View All Bookings | `admin`, `manager`, `staff` |
| `/api/admin/clients` | GET | View User List | `admin`, `manager` |
| `/api/admin/staff` | GET/POST | Manage Staff Accounts | `admin` |
| `/api/admin/settings` | GET/PUT | Business Settings | `admin` |
| **Bookings & Menu** | | | |
| `/api/bookings` | POST | Create Booking | Authenticated User |
| `/api/bookings/user/:id` | GET | View My Bookings | Authenticated Owner |
| `/api/menu` | GET | View Menu Items | Public |
| `/api/menu` | POST/PUT | Manage Menu | `admin` (implied) |

---

## 3. Application Architecture & Data Flow

### Request Flow
1.  **UI Component:** (e.g., `BookingWidget.jsx`) collects user input.
2.  **Service/Context:** `handleSubmit` calls `fetch('/api/bookings')` with JWT.
3.  **Backend Route:** `routes/bookings.js` receives request.
4.  **Controller Logic:**
    -   Validates overlap: `(StartA < EndB) AND (EndA > StartB)`.
    -   Calculates Price: `(Duration * Rate) + PreOrders`.
5.  **Database:** Mongoose saves document to MongoDB.
6.  **Response:** Server returns `201 Created`.
7.  **UI Update:** Frontend receives success, shows Confirmation Modal, and clears state.

### 3D/Parallax Integration
-   **Visuals:** `Scene3D` (R3F) renders a 3D pool table scene in `Hero.jsx` and `BookingPage.jsx`.
-   **Sync:** While the 3D scene is currently aesthetic, it is contained within React components that are state-aware. Future improvements could bind `Table` availability state (from API) to the 3D model's texture/color (e.g., Red for busy, Green for open).

---

## 4. Admin Dashboard Module Separation

| Role | Permissions | Justification |
| :--- | :--- | :--- |
| **Admin** | **Full Access** | Can manage Users, Finances, Staff, Settings, and sensitive data. |
| **Manager** | **Operational + Reporting** | Can view Dashboard Stats, Manage Inventory, Bookings, and Clients. Cannot edit Business Settings or Manage Staff. |
| **Staff** | **Operational Only** | Can View/Manage Active Bookings, Orders, and Pool Tables. No access to financial aggregates or user data. |

---

## 5. Deployment Readiness Check

### Environment Variables
-   **Backend:**
    -   `PORT`: Server port (e.g., 5000)
    -   `MONGODB_URI`: Connection string for production DB.
    -   `JWT_SECRET`: Strong secret for token signing.
-   **Frontend (Admin):**
    -   `NEXT_PUBLIC_API_URL`: URL of the deployed backend.
-   **Frontend (Customer):**
    -   `VITE_API_URL` (in `config.js`): URL of the deployed backend.

### Sanity Checks
-   ✅ **No Hardcoded Data:** All Dashboard stats, bookings, menu items, and tables are fetched from the API.
-   ✅ **Security:** Admin routes are protected by `roleMiddleware`.
-   ✅ **Responsiveness:** Both Admin and Customer interfaces feature mobile-responsive layouts (Sidebar toggles, Grid adaptations).
-   ✅ **Error Handling:** Global error boundaries (`error.tsx`) and Graceful UI feedbacks are in place.

---
*Report generated by Antigravity Agent on 2026-02-14.*
